<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./style.css">
    <link rel="stylesheet" href="./upload.css">
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/material-design-icons/3.0.1/iconfont/material-icons.min.css">

    <title>Add Candidate</title>
    <style>
       .bodyTag {
    background-color: #f0f4f7;
    font-family: Arial, sans-serif;
    color: #333;
}

.container {
    max-width: 600px;
    margin: 0 auto;
    padding: 20px;
    background-color: #fff;
    border-radius: 10px;
    box-shadow: 0px 0px 20px rgba(0, 0, 0, 0.1);
}

form {
    display: flex;
    flex-direction: column;
}

label,
input,
select {
    margin-bottom: 15px;
}

input[type="text"],
select {
    padding: 12px;
    border: 1px solid #ccc;
    border-radius: 5px;
    font-size: 16px;
    width: 100%;
    box-sizing: border-box;
}

button[type="submit"] {
    margin-top: 20px;
    padding: 12px 24px;
    background-color: #4CAF50;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    transition: background-color 0.3s ease;
}

button[type="submit"]:hover {
    background-color: #45a049;
}

#snackbar {
    display: none;
    position: fixed;
    top: 20px;
    right: 20px;
    background-color: #333;
    color: #fff;
    padding: 16px;
    border-radius: 8px;
}

.form-group {
    margin-bottom: 30px;
}

.form-group label {
    display: block;
    font-weight: bold;
    margin-bottom: 10px;
}

.form-group input[type="file"] {
    width: 100%;
    padding: 15px;
    border: 2px solid #ddd;
    border-radius: 8px;
    background-color: #f9f9f9;
}

.form-group button {
    background-color: #007bff;
    color: #fff;
    border: none;
    padding: 12px 24px;
    border-radius: 5px;
    cursor: pointer;
}

.form-group button:hover {
    background-color: #0056b3;
}

.message {
    margin-top: 30px;
    padding: 15px;
    border-radius: 8px;
}

.success {
    background-color: #dff0d8;
    border-color: #d6e9c6;
    color: #3c763d;
}

.error {
    background-color: #f2dede;
    border-color: #ebccd1;
    color: #a94442;
}
#nextCallback {

height: 40px;
}
#taskAssignedAt {

height: 40px;
}


    </style>
</head>

<body>
    <!-- Admin Navbar -->
    <nav class="admin-navbar navbar">
        <!-- Your admin navbar content here -->
        <div class="logo">
            <img src="./HRM.jpg" alt="Admin Logo">
        </div>
        <div class="panelType">Admin Panel</div>
        <div class="nav-links">
            <a href="newTask.html" class="nav-link">Events</a>
            <a href="addUser.html" class="nav-link">Add User</a>
            <a href="userList.html" class="nav-link">User List</a>
            
            <a href="addCandidate.html" class="nav-link">Add Candidate</a>
            <a href="allCandidateList.html" class="nav-link">Candidates List</a>
            <!-- <a href="addCandidate.html" class="nav-link">Add Candidate</a> -->
            <button class="logout-btn2">Logout</button>
        </div>
    </nav>

    <nav class="hr-navbar navbar">
        <!-- Your admin navbar content here -->
        <div class="logo">
            <img src="./HRM.jpg" alt="HR Logo">
        </div>
        <div class="panelType">Recruiter Panel</div>

        <div class="nav-links">
                <a href="newTask.html" class="nav-link">New Events</a>
            <a href="myTask.html" class="nav-link">My Events</a>
            <a href="addCandidate.html" class="nav-link">Add Candidate</a>
            <a href="candidateList.html" class="nav-link">Candidates List</a>
            <button class="logout-btn3">Logout</button>
        </div>
    </nav>

    <nav class="manager-navbar navbar">
        <!-- Your admin navbar content here -->
        <div class="logo">
            <img src="./HRM.jpg" alt="Manager Logo">
        </div>
        <div class="panelType">Manager Panel</div>

        <div class="nav-links">
                <a href="newTask.html" class="nav-link">New Events</a>
            <a href="myTask.html" class="nav-link">My Events</a>
            <a href="addCandidate.html" class="nav-link">Add Candidate</a>
            <a href="candidateList.html" class="nav-link">Candidates List</a>
            <button class="logout-btn">Logout</button>
        </div>
    </nav>

    <!-- Regular Navbar -->
    <nav class="regular-navbar navbar">
        <!-- Your regular navbar content here -->
        <div class="logo">
            <img src="./HRM.jpg" alt="Logo">
        </div>
        <div class="nav-links">
            <a href="login.html" class="nav-link">Login</a>
            <a href="register.html" class="nav-link">Register</a>
        </div>
    </nav>


    <script src="script.js"></script>
    <script>
        const token = localStorage.getItem('token');
        const adminNavbar = document.querySelector('.admin-navbar');
        const regularNavbar = document.querySelector('.regular-navbar');
        const hrNavbar = document.querySelector('.hr-navbar');
        const managerNavbar = document.querySelector('.manager-navbar');

        if (token) {
            fetchUserData(); // Call the function to fetch user data
        } else {
            // Show regular navbar if no token found
            regularNavbar.style.display = 'flex';
        }

        async function fetchUserData() {
            const requestOptions = {
                method: 'GET',
                headers: {
                    'Accept': '*/*',
                    'Authorization': `Bearer ${token.replace(/^"(.*)"$/, '$1')}`,
                    'Sec-Fetch-Mode': 'cors',
                    'Sec-Fetch-Site': 'cross-site'
                }
            };

            console.log("fffffffffffffffffffffffff");

            try {
                const response = await fetch('http://localhost:4004/auth/me', requestOptions);
                const data = await response.json();
                console.log(data, "data in loggs");
                if (data.role == 'admin') {
                    adminNavbar.style.display = 'flex'; // Show admin navbar
                } else if (data.role == 'recruiter') {
                    hrNavbar.style.display = 'flex'; // Show regular navbar
                } else if (data.role == 'manager') {
                    managerNavbar.style.display = 'flex'; // Show regular navbar
                } else {
                    regularNavbar.style.display = 'flex'; // Show regular navbar
                }
            } catch (error) {
                console.error('Error fetching user data:', error);
            }
        }
    </script>
    <script>
        function uploadFile() {
            const fileInput = document.getElementById('file');
            const file = fileInput.files[0];
            const formData = new FormData();
            formData.append('file', file);

            fetch('http://localhost:4004/upload', {
                method: 'POST',
                body: formData
            })
                .then(response => response.json())
                .then(data => {
                    const snackbar = document.getElementById('snackbar');
                    snackbar.textContent = "Resume Uploaded successfully !";
                    snackbar.style.display = 'block';
                    const resumeFile = data?.file

                    localStorage.setItem('fileVal', resumeFile);

                    setTimeout(() => {
                        snackbar.style.display = 'none';
                    }, 3000);
                    const messageDiv = document.getElementById('message');
                    if (data.status === 200) {
                        messageDiv.className = 'message success';
                        messageDiv.innerText = data.message + ' File URL: ' + data.file;

                    } else {
                        messageDiv.className = 'message error';
                        messageDiv.innerText = data.message;
                    }
                    messageDiv.style.display = 'block';
                     // Page reload ko rokne ke liye
        window.onbeforeunload = () => {
            return false;
        };
                    
                })
                .catch(error => {
                    console.error('Error:', error);
                    const messageDiv = document.getElementById('message');
                    messageDiv.className = 'message error';
                    messageDiv.innerText = 'An error occurred. Please try again later.';
                    messageDiv.style.display = 'block';
                });
            
        }
    </script>
    <div class="bodyTag">
        <div class="container">
            <h1>Add Candidate</h1>


            <!-- <div class="form-group">
                <button onclick="uploadFile()">Upload</button>
            </div> -->
            <form id="candidateForm">
                <!-- Qualification -->

                <label for="candidateName">Name:</label>
                <input type="text" id="candidateName" name="candidateName" required><br>

                <label for="phoneNumber">Phone Number:</label>
                <input type="text" id="phoneNumber" name="phoneNumber" required><br>

                <label for="qualification">Qualification:</label>
                <input type="text" id="qualification" name="qualification" required><br>

                <!-- Experience -->
                <label for="experience">Experience:</label>
                <input type="text" id="experience" name="experience" required><br>

                <!-- Computer Skills -->
                <label for="computerSkills">Computer Skills:</label>
                <select id="computerSkills" name="computerSkills">
                    <option value="Introduction level">Introduction level</option>
                    <option value="Basic level">Basic level</option>
                    <option value="Intermediate level">Intermediate level</option>
                    <option value="Can work easily">Can work easily</option>
                </select><br>

                <!-- English Skills -->
                <label for="englishSkills">English Skills:</label>
                <select id="englishSkills" name="englishSkills">
                    <option value="Introduction level">Introduction level</option>
                    <option value="Basic level">Basic level</option>
                    <option value="Intermediate level">Intermediate level</option>
                    <option value="Can work easily">Can work easily</option>
                </select><br>

                <!-- Other Skills -->
                <label for="otherSkills">Other Skills:</label>
                <input type="text" id="otherSkills" name="otherSkills" required><br>

                <!-- Remark -->
                <label for="remark">Remark:</label>
                <select id="remark" name="remark">
                    <option value="Selected">Selected</option>
                    <option value="Rejected">Rejected</option>
                    <option value="Under Process">Under Process</option>
                </select><br>

                <!-- Category -->
                <label for="category">Category:</label>
                <select id="category" name="category">
                    <option value="Software Development">Software Development</option>
                    <option value="Sales">Sales</option>
                    <option value="Calling International">Calling International</option>
                    <option value="Calling Domestic">Calling Domestic</option>
                    <option value="Housekeeping">Housekeeping</option>
                    <option value="Day Clerical">Day Clerical</option>
                    <option value="Marketing">Marketing</option>
                    <option value="Internet Marketing">Internet Marketing</option>
                    <option value="Graphic Design">Graphic Design</option>
                    <option value="Other">Other</option>
                </select><br>

                <!-- Detailed Remark -->
                <label for="detailedRemark">Detailed Remark:</label>
                <input type="text" id="detailedRemark" name="detailedRemark" required><br>

                <!-- Next Callback -->
                <label for="nextCallback">Next Callback:</label>
                <input type="datetime-local" id="nextCallback" name="nextCallback"><br>

                <!-- Task Assigned To (Dynamically populated dropdown) -->
                <label for="taskAssignedTo">Task Assigned To:</label>
                <select id="taskAssignedTo" name="taskAssignedTo"></select><br>

                <!-- Task Assigned At -->
                <label for="taskAssignedAt">Task Assigned At:</label>
                <input type="datetime-local" id="taskAssignedAt" name="taskAssignedAt"><br>
                <div class='file file--upload'>
                    <label for='file'>
                        <i class="material-icons">cloud_upload</i>Upload
                    </label>
                    <input type="file" id="file" accept=".pdf">
                </div>
                <!-- Submit Button -->
                <button type="submit">Submit</button>
            </form>

            <!-- Snackbar for displaying API response -->
            <div id="snackbar"></div>
        </div>
    </div>

    <!-- JavaScript for fetching data and form submission -->
    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                const fileInput = document.getElementById('file');
                fileInput.addEventListener('change', () => {
                    uploadFile();
                });
                const response = await fetch(`http://localhost:4004/user/list`);
                const responseData = await response.json();

                const taskAssignedToSelect = document.getElementById('taskAssignedTo');
                responseData.data.forEach(user => {
                    const option = document.createElement('option');
                    option.value = user.id;
                    option.textContent = `${user.first_name} ${user.last_name}`;
                    taskAssignedToSelect.appendChild(option);
                });
            } catch (error) {
                console.error('Error fetching data:', error);
            }
        });

        document.getElementById('candidateForm').addEventListener('submit', async (event) => {
            event.preventDefault();

            const formData = new FormData(event.target);
            const fileVal = localStorage.getItem('fileVal');
            formData.append('resume', fileVal);


            const data = {};
            formData.forEach((value, key) => {
                data[key] = value;
            });



            const token = localStorage.getItem('token');
            if (token) {
                try {
                    const response = await fetch('http://localhost:4004/candidate/add', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${token.replace(/^"(.*)"$/, '$1')}`,
                        },
                        body: JSON.stringify(data),
                    });
                    const responseData = await response.json();

                    const snackbar = document.getElementById('snackbar');
                    snackbar.textContent = responseData.message;
                    snackbar.style.display = 'block';

                    setTimeout(() => {
                        snackbar.style.display = 'none';
                    }, 3000);
                } catch (error) {
                    console.error('Error:', error);
                }
            } else {
                console.error('No token found in localStorage');
            }
        });
    </script>
</body>

</html>