<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">


    <title>Client list</title>
    <style>
        body {
            background-color: #f0f4f7;
            font-family: Arial, sans-serif;
            color: #333;
            margin: 0;
            padding: 0;
        }

        .container {
            max-width: 90%;
            margin: 20px auto;
            padding: 20px;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.1);
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
            white-space: nowrap;
            /* Add this line to prevent text wrapping */
        }

        th,
        td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }

        th {
            background-color: #007bff;
            color: #fff;
        }

        tr:nth-child(even) {
            background-color: #f2f2f2;
        }

        .button-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .button-container button {
            padding: 8px 16px;
            background-color: #007bff;
            color: #fff;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .button-container button:hover {
            background-color: #0056b3;
        }

        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 998;
        }

        .modal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.1);
            z-index: 999;
            max-width: 80%;
        }

        .modal h2 {
            margin-bottom: 10px;
            color: #333;
        }

        .modal input,
        .modal select {
            width: 98%;
            margin-bottom: 10px;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

        .modal button {
            padding: 8px 16px;
            background-color: #007bff;
            color: #fff;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .modal button:hover {
            background-color: #0056b3;
        }
       /* CSS for action buttons */
.editButton {
    padding: 8px 16px;
    background-color: #4285f4; /* Blue color */
    color: #fff;
    font-weight: bold; /* Make text bold */
    border: none;
    border-radius: 4px;
    cursor: pointer;
    transition: background-color 0.3s ease;
}

.editButton:hover {
    background-color: #3366cc; /* Slightly darker blue color on hover */
}

.deleteButton {
    padding: 8px 16px;
    background-color: #ea4335; /* Red color */
    color: #fff;
    font-weight: bold; /* Make text bold */
    border: none;
    border-radius: 4px;
    cursor: pointer;
    transition: background-color 0.3s ease;
}

.deleteButton:hover {
    background-color: #cc3333; /* Slightly darker red color on hover */
}

.downloadButton {
    padding: 8px 16px;
    background-color: #34a853; /* Green color */
    color: #fff;
    font-weight: bold; /* Make text bold */
    border: none;
    border-radius: 4px;
    cursor: pointer;
    transition: background-color 0.3s ease;
}

.downloadButton:hover {
    background-color: #2b8a3e; /* Slightly darker green color on hover */
}

.viewButton {
    padding: 8px 16px;
    background-color: #fbbc05; /* Yellow color */
    color: #fff;
    font-weight: bold; /* Make text bold */
    border: none;
    border-radius: 4px;
    cursor: pointer;
    transition: background-color 0.3s ease;
}

.viewButton:hover {
    background-color: #e6a200; /* Slightly darker yellow color on hover */
}

        
    </style>
</head>

<body>
    <!-- Admin Navbar -->
    <nav class="admin-navbar navbar">
        <!-- Your admin navbar content here -->
        <div class="logo">
            <img src="./HRM.jpg" alt="Admin Logo">
        </div>
        <div class="panelType">Admin Panel</div>
        <div class="nav-links">
            <a href="newTask.html" class="nav-link">Events</a>
            <a href="addUser.html" class="nav-link">Add User</a>
            <a href="userList.html" class="nav-link">User List</a>
            
            <a href="addCandidate.html" class="nav-link"> Add Client</a>
            <a href="allCandidateList.html" class="nav-link">Client list</a>
            <a href="profile.html" class="nav-link profile-icon">
                <i class="fa-solid fa-user"></i> <!-- Font Awesome user icon -->
            </a>
            <!-- <a href="addCandidate.html" class="nav-link"> Add Client</a> -->
            <button class="logout-btn">Logout</button>
        </div>
    </nav>

    <nav class="hr-navbar navbar">
        <!-- Your admin navbar content here -->
        <div class="logo">
            <img src="./HRM.jpg" alt="HR Logo">
        </div>
        <div class="panelType">Recruiter Panel</div>

        <div class="nav-links">
                <a href="newTask.html" class="nav-link">New Events</a>
            <a href="myTask.html" class="nav-link">My Events</a>
            <a href="addCandidate.html" class="nav-link"> Add Client</a>
            <a href="candidateList.html" class="nav-link" style="background-color: #507ca8;">Client list</a>
            <a href="profile.html" class="nav-link profile-icon">
                <i class="fa-solid fa-user"></i> <!-- Font Awesome user icon -->
            </a>
            <button class="logout-btn2">Logout</button>
        </div>
    </nav>

    <nav class="manager-navbar navbar">
        <!-- Your admin navbar content here -->
        <div class="logo">
            <img src="./HRM.jpg" alt="Manager Logo">
        </div>
        <div class="panelType">Manager Panel</div>

        <div class="nav-links">
                <a href="newTask.html" class="nav-link">New Events</a>
            <a href="myTask.html" class="nav-link">My Events</a>
            <a href="addCandidate.html" class="nav-link"> Add Client</a>
            <a href="candidateList.html" class="nav-link" style="background-color: #507ca8;">Client list</a>
            <a href="profile.html" class="nav-link profile-icon">
                <i class="fa-solid fa-user"></i> <!-- Font Awesome user icon -->
            </a>
            <button class="logout-btn3">Logout</button>
        </div>
    </nav>

    <!-- Regular Navbar -->
    <nav class="regular-navbar navbar">
        <!-- Your regular navbar content here -->
        <div class="logo">
            <img src="./HRM.jpg" alt="Logo">
        </div>
        <div class="nav-links">
            <a href="login.html" class="nav-link">Login</a>
            <a href="register.html" class="nav-link">Register</a>
        </div>
    </nav>


    <script src="script.js"></script>
    <script>
        const token = localStorage.getItem('token');
        const adminNavbar = document.querySelector('.admin-navbar');
        const regularNavbar = document.querySelector('.regular-navbar');
        const hrNavbar = document.querySelector('.hr-navbar');
        const managerNavbar = document.querySelector('.manager-navbar');

        if (token) {
            fetchUserData(); // Call the function to fetch user data
        } else {
            // Show regular navbar if no token found
            regularNavbar.style.display = 'flex';
        }

        async function fetchUserData() {
            const requestOptions = {
                method: 'GET',
                headers: {
                    'Accept': '*/*',
                    'Authorization': `Bearer ${token.replace(/^"(.*)"$/, '$1')}`,
                    'Sec-Fetch-Mode': 'cors',
                    'Sec-Fetch-Site': 'cross-site'
                }
            };

            console.log("fffffffffffffffffffffffff");

            try {
                const response = await fetch('http://localhost:4004/auth/me', requestOptions);
                const data = await response.json();
                console.log(data, "data in loggs");
                if (data.role == 'admin') {
                    adminNavbar.style.display = 'flex'; // Show admin navbar
                } else if (data.role == 'recruiter') {
                    hrNavbar.style.display = 'flex'; // Show regular navbar
                } else if (data.role == 'manager') {
                    managerNavbar.style.display = 'flex'; // Show regular navbar
                } else {
                    regularNavbar.style.display = 'flex'; // Show regular navbar
                }
            } catch (error) {
                console.error('Error fetching user data:', error);
            }
        }
    </script>
    <div class="bodyTag">
        <div class="container">
            <h1>My Client list</h1>
            <div class="button-container">
                <!-- <button id="addCandidateButton"> Add Client</button> -->
                <a href="#" id="refreshButton" style="display: none;">Refresh List</a>
            </div>
            <table id="candidateTable">
                <thead>
                    <tr>
                        <th>Recruiter Name</th>
                        <th>Qualification</th>
                        <th>Candidate Name</th>
                        <th>Phone Number</th>
                        <th>Experience</th>
                        <th>Computer Skills</th>
                        <th>English Skills</th>
                        <th>Other Skills</th>
                        <th>Remark</th>
                        <th>Category</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Table rows will be dynamically populated here -->
                </tbody>
            </table>
        </div>

        <!-- Modal overlay -->
        <div class="modal-overlay" id="modalOverlay"></div>

        <!-- Edit Modal -->
        <div class="modal" id="editModal">
            <h2>Edit Candidate</h2>
            <form id="editForm" class="styled-form">
                <div class="form-group">
                    <label for="qualification">Qualification:</label>
                    <input type="text" id="qualification" name="qualification" required>
                </div>
        
                <div class="form-group">
                    <label for="candidateName">Candidate Name:</label>
                    <input type="text" id="candidateName" name="candidateName" required>
                </div>
        
                <div class="form-group">
                    <label for="phoneNumber">Phone Number:</label>
                    <input type="text" id="phoneNumber" name="phoneNumber" required>
                </div>
        
                <div class="form-group">
                    <label for="experience">Experience:</label>
                    <input type="text" id="experience" name="experience" required>
                </div>
        
                <div class="form-group">
                    <label for="computerSkills">Computer Skills:</label>
                    <select id="computerSkills" name="computerSkills">
                        <option value="Introduction level">Introduction level</option>
                        <option value="Basic level">Basic level</option>
                        <option value="Intermediate level">Intermediate level</option>
                        <option value="Can work easily">Can work easily</option>
                    </select>
                </div>
        
                <div class="form-group">
                    <label for="englishSkills">English Skills:</label>
                    <select id="englishSkills" name="englishSkills">
                        <option value="Introduction level">Introduction level</option>
                        <option value="Basic level">Basic level</option>
                        <option value="Intermediate level">Intermediate level</option>
                        <option value="Can work easily">Can work easily</option>
                    </select>
                </div>
        
                <div class="form-group">
                    <label for="otherSkills">Other Skills:</label>
                    <input type="text" id="otherSkills" name="otherSkills" required>
                </div>
        
                <div class="form-group">
                    <label for="remark">Remark:</label>
                    <select id="remark" name="remark">
                        <option value="Selected">Selected</option>
                        <option value="Rejected">Rejected</option>
                        <option value="Under Process">Under Process</option>
                    </select>
                </div>
        
                <div class="form-group">
                    <label for="category">Category:</label>
                    <select id="category" name="category">
                        <option value="Software Development">Software Development</option>
                        <option value="Sales">Sales</option>
                        <option value="Calling International">Calling International</option>
                        <option value="Calling Domestic">Calling Domestic</option>
                        <option value="Housekeeping">Housekeeping</option>
                        <option value="Day Clerical">Day Clerical</option>
                        <option value="Marketing">Marketing</option>
                        <option value="Internet Marketing">Internet Marketing</option>
                        <option value="Graphic Design">Graphic Design</option>
                        <option value="Other">Other</option>
                    </select>
                </div>
        
                <button type="submit">Save Changes</button>
            </form>
        </div>
        

    </div>

    <!-- JavaScript for fetching and manipulating data -->
    <script>
        function navigateToCandidateDetail(candidateId) {
            // Construct the URL with the candidate ID
            var url = `candidateDetail.html?id=${candidateId}`;

            // Redirect the user to the constructed URL
            window.location.href = url;
        }
        function downloadResume(resumeUrl) {
            var link = document.createElement('a');
            link.href = resumeUrl;
            // link.setAttribute('download', 'resume.pdf');
            link.setAttribute('target', '_blank');
            link.click();
        }
        document.addEventListener('DOMContentLoaded', async () => {
            const token = localStorage.getItem('token');
            const candidateTable = document.getElementById('candidateTable');
            const modalOverlay = document.getElementById('modalOverlay');
            const editModal = document.getElementById('editModal');
            const editForm = document.getElementById('editForm');
            const refreshButton = document.getElementById('refreshButton');

            refreshButton.addEventListener('click', async () => {
                try {
                    const response = await fetch('http://localhost:4004/candidate/myList', {
                        headers: {
                            'Authorization': `Bearer ${token.replace(/^"(.*)"$/, '$1')}`,
                        },
                    });
                    const responseData = await response.json();

                    if (responseData.status === '200') {
                        renderCandidates(responseData.data);
                    } else {
                        console.error('Error fetching Client list:', responseData.message);
                    }
                } catch (error) {
                    console.error('Error fetching Client list:', error);
                }
            });

            function renderCandidates(candidates) {
                let tableRows = '';
                candidates.forEach(candidate => {
                    const { resume, recruiterId, qualification, candidateName, phoneNumber, experience, computerSkills, englishSkills, otherSkills, remark, category, id } = candidate;
                    const recruiterName = candidate.recruiterId.first_name;
                    tableRows += `
                        <tr>
                            <td>${recruiterName}</td>
                            <td>${qualification}</td>
                            <td>${candidateName}</td>
                            <td>${phoneNumber}</td>
                            <td>${experience}</td>
                            <td>${computerSkills}</td>
                            <td>${englishSkills}</td>
                            <td>${otherSkills}</td>
                            <td>${remark}</td>
                            <td>${category}</td>
                            <td>
                                <button class="editButton" data-id="${id}">Edit</button>
                                <button class="deleteButton" data-id="${id}">Delete</button>
                                <button onclick="downloadResume('${resume}')" class="downloadButton">Resume</button>
                                <button onclick="navigateToCandidateDetail('${id}')" class="viewButton">View Candidate</button>

                            </td>
                        </tr>
                    `;
                });
                candidateTable.querySelector('tbody').innerHTML = tableRows;

                // Add event listeners to edit and delete buttons
                document.querySelectorAll('.editButton').forEach(button => {
                    button.addEventListener('click', () => openEditModal(button.dataset.id));
                });

                document.querySelectorAll('.deleteButton').forEach(button => {
                    button.addEventListener('click', () => confirmDelete(button.dataset.id));
                });
            }

            async function openEditModal(candidateId) {
                try {
                    const response = await fetch(`http://localhost:4004/candidate/get/${candidateId}`, {
                        method: 'GET',
                        headers: {
                            'Authorization': `Bearer ${token.replace(/^"(.*)"$/, '$1')}`,
                        },
                    });
                    const responseData = await response.json();

                    if (responseData.status === '200') {
                        const candidate = responseData.data;
                        populateEditForm(candidate);
                        editModal.style.display = 'block';
                        modalOverlay.style.display = 'block';
                    } else {
                        console.error('Error fetching candidate data:', responseData.message);
                    }
                } catch (error) {
                    console.error('Error fetching candidate data:', error);
                }
            }

            function populateEditForm(candidate) {
                const { qualification, candidateName, phoneNumber, experience, computerSkills, englishSkills, otherSkills, remark, category } = candidate;
                const editFormInputs = editForm.elements;

                editFormInputs.qualification.value = qualification;
                editFormInputs.candidateName.value = candidateName;
                editFormInputs.phoneNumber.value = phoneNumber;
                editFormInputs.experience.value = experience;
                editFormInputs.computerSkills.value = computerSkills;
                editFormInputs.englishSkills.value = englishSkills;
                editFormInputs.otherSkills.value = otherSkills;
                editFormInputs.remark.value = remark;
                editFormInputs.category.value = category;

                editForm.dataset.id = candidate.id; // Store candidate ID in the form dataset for submission
            }

            editForm.addEventListener('submit', async (event) => {
                event.preventDefault();

                const formData = new FormData(event.target);
                const data = {};
                formData.forEach((value, key) => {
                    data[key] = value;
                });

                try {
                    const candidateId = editForm.dataset.id;
                    const response = await fetch(`http://localhost:4004/candidate/update/${candidateId}`, {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${token.replace(/^"(.*)"$/, '$1')}`,
                        },
                        body: JSON.stringify(data),
                    });
                    const responseData = await response.json();

                    if (responseData.status === '200') {
                        alert('Candidate data updated successfully!');
                        editModal.style.display = 'none';
                        modalOverlay.style.display = 'none';
                        refreshButton.click(); // Refresh the list
                    } else {
                        console.error('Error updating candidate data:', responseData.message);
                    }
                } catch (error) {
                    console.error('Error updating candidate data:', error);
                }
            });

            function confirmDelete(candidateId) {
                if (confirm('Are you sure you want to delete this candidate?')) {
                    deleteCandidate(candidateId);
                }
            }

            async function deleteCandidate(candidateId) {
                try {
                    const response = await fetch(`http://localhost:4004/candidate/delete/${candidateId}`, {
                        method: 'DELETE',
                        headers: {
                            'Authorization': `Bearer ${token.replace(/^"(.*)"$/, '$1')}`,
                        },
                    });
                    const responseData = await response.json();

                    if (responseData.status === '200') {
                        alert('Candidate deleted successfully!');
                        refreshButton.click(); // Refresh the list
                    } else {
                        console.error('Error deleting candidate:', responseData.message);
                    }
                } catch (error) {
                    console.error('Error deleting candidate:', error);
                }
            }

            // Close the modal when clicking outside or pressing Escape key
            modalOverlay.addEventListener('click', () => {
                editModal.style.display = 'none';
                modalOverlay.style.display = 'none';
            });

            document.addEventListener('keydown', (event) => {
                if (event.key === 'Escape') {
                    editModal.style.display = 'none';
                    modalOverlay.style.display = 'none';
                }
            });

            // Initial data fetch on page load
            refreshButton.click();
        });
    </script>
</body>

</html>